<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="1-click OpenBazaar!">
	<title>EasyBazaar: 1-click deployment of OpenBazaar</title>
	<link rel="icon" type="image/png" href="assets/images/favicon.png" />

	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

	<!-- Custom styles for this template -->
	<!-- <link href="assets/css/theme.css" rel="stylesheet"> -->
	<link href="assets/css/one-page-wonder.css" rel="stylesheet">

</head>
<body>

	<!-- Navbar -->
	<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
	  <div class="container">
	    <div class="navbar-header">
	      <a class="navbar-brand" href="#">EasyBazaar</a>
	    </div>
	    <div id="navbar" class="collapse navbar-collapse">
	      <ul class="nav navbar-nav">
	        <li class="active"><a href="#">Home</a></li>
	        <li><a href="https://openbazaar.org/?ref=easybazaar" target="_blank">Get OpenBazaar</a></li>
	      </ul>
	    </div>
	  </div>
	</nav>

	<!-- Full Width Image Header -->
    <header class="header-image">
        <div class="headline">
            <div class="container">
                <h1>EasyBazaar</h1>
                <h3>1-click deployment of OpenBazaar.</h3>
            </div>
        </div>
    </header>
    </br>

    <!-- Page Content -->
	<div class="container">
    <div class="featurette">
      </br><p class="lead">Setting up your OpenBazaar store to be online 24/7 can be tricky. EasyBazaar is a convenient 1-click solution to create a Digital Ocean droplet (virtual private server) installed with OpenBazaar.</p></br>
    </div>
    <hr>

	   <!-- Step 1: Sign-up -->
    <div class="featurette" id="step1">
        <img class="featurette-image img-responsive pull-right" src="assets/images/signup.png" width="500px">
        <h2 class="featurette-heading">Step 1:
            <span class="text-muted">Sign-up to Digital Ocean for Free</span>
        </h2>
        <p class="lead">To get started, you need to sign-up to Digital Ocean. </br></br><a href="https://m.do.co/c/eaa306f7dd3d"><strong>If you join using this link</strong></a>, you'll receive $10 credit, which is about 2 months of running OpenBazaar for free! After that, it's only $5/month.</p>
    </div>
    <hr class="featurette-divider">

    <!-- Step 2: Copy the API Token -->
    <div class="featurette" id="step2">
		<img class="featurette-image img-responsive pull-left" src="assets/images/token_instructions.gif" width="500px">
        <h2 class="featurette-heading">Step 2:
            <span class="text-muted">Copy the API token</span>
        </h2>
        <p class="lead">Generate a new token, as per the gif to the left. Make sure it has both <code>read</code> and <code>write</code> access. Copy the token and go to Step 3.</p>
    </div>
    <hr class="featurette-divider">

    <!-- Step 3: Deploy -->
    <div class="featurette" id="step3">
        <div class="well well-lg featurette-image col-lg-5 col-md-5 col-sm-12 col-xs-12 img-responsive pull-right"><p id="dasinfo" style="word-wrap: break-word;"><code>Ready. Add your API token and click 'Deploy!'.</code></p></br></br></br></br></br></br></br></br></br>
        </div>
        <h2 class="featurette-heading">Step 3:
            <span class="text-muted">Add the token and click 'Deploy'</span>
        </h2>
        <p class="lead">Add your API token from Step 2 and click the button below... easy as that!</p>
        <!-- VPS Creation Form -->
    		<form>
    			<div class="input-group input-group-lg">
    				<span class="input-group-addon" id="sizing-addon1">Token:</span>
    				<input class="form-control" aria-describedby="sizing-addon1" type="text" id="token" name="token" placeholder="e.g. abcdefg123456789868ac60920f00152840475b63607d543ce89d3d42b66bc6a">
    				<input hidden name="size" value="512mb">
    				<input hidden name="region" value="sfo2">
    			</div>
    			</br>
    			<button type="button" class="btn btn-info btn-lg" onclick="App.createvps(this, document.getElementById('cloud-init-script-template').innerText)">Deploy!</button>
    		</form>
    </div>
    <hr class="featurette-divider">

    <!-- Step 4: Download OB -->
    <div class="featurette" id="step4">
        <img class="featurette-image img-responsive pull-left" src="assets/images/download-ob.gif" width="500px">
        <h2 class="featurette-heading">Step 4:
            <span class="text-muted">Get OpenBazaar</span>
        </h2>
        <p class="lead"><a href="https://openbazaar.org">Download OpenBazaar</a> and install it on your computer.</br></br>When you run it for the first time, a local node will be created by default. After you complete setting up your local node, go to Step 5.</p>
    </div>
    <hr class="featurette-divider">

	<!-- Step 5: Connect -->
    <div class="featurette" id="step5">
        <img class="featurette-image img-responsive pull-right" src="assets/images/connect.gif" width="500px">
        <h2 class="featurette-heading">Step 5:
            <span class="text-muted">Connect to your store</span>
        </h2>
        <p class="lead">Add your 'EasyBazaar' OpenBazaar node to your list of connections. Then login and setup your store!</p>
    </div>
    <hr class="featurette-divider">
	</div>

  <br>
  <div class="container"> 
    <form action="http://128.199.224.210:8080/api/v1/status" method="GET" onclick="sendpassword()">
        <input value="poop" id="status_password" name="password" />
        <input type="submit" />
    </form>
  </div>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/2.2.1/mustache.min.js"></script>

	<script src="assets/js/bip39.js"></script>
	<script src="assets/js/digitalocean.js"></script>
	<script src="assets/js/app.js"></script>

  <!-- Footer -->
  <div class="container">
    <footer>
        <div class="row">
            <div class="col-lg-12">
                <p><strong>Github:</strong> <a href="https://github.com/OpenBazaar/miniprovistor-web">https://github.com/OpenBazaar/miniprovistor-web</a></p>
            </div>
        </div>
    </footer>
  </div>
</body>

<!-- Disable multiple button clicks -->
<script>
$('button').on('click', function() {
    $(this).prop('disabled', true);
});
</script>

<!-- Encode for sending a password -->
<script>
  function sendpassword() {
    var Base64 = {
      _keyStr: "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",
      encode: function(input) {
          var output = "";
          var chr1, chr2, chr3, enc1, enc2, enc3, enc4;
          var i = 0;
          input = Base64._utf8_encode(input);
          while (i < input.length) {
              chr1 = input.charCodeAt(i++);
              chr2 = input.charCodeAt(i++);
              chr3 = input.charCodeAt(i++);
              enc1 = chr1 >> 2;
              enc2 = ((chr1 & 3) << 4) | (chr2 >> 4);
              enc3 = ((chr2 & 15) << 2) | (chr3 >> 6);
              enc4 = chr3 & 63;
              if (isNaN(chr2)) {
                  enc3 = enc4 = 64;
              } else if (isNaN(chr3)) {
                  enc4 = 64;
              }
              output = output + this._keyStr.charAt(enc1) + this._keyStr.charAt(enc2) + this._keyStr.charAt(enc3) + this._keyStr.charAt(enc4);
          }
          return output;
      },
      _utf8_encode: function(string) {
          string = string.replace(/\r\n/g, "\n");
          var utftext = "";
          for (var n = 0; n < string.length; n++) {
              var c = string.charCodeAt(n);
              if (c < 128) {
                  utftext += String.fromCharCode(c);
              }
              else if ((c > 127) && (c < 2048)) {
                  utftext += String.fromCharCode((c >> 6) | 192);
                  utftext += String.fromCharCode((c & 63) | 128);
              }
              else {
                  utftext += String.fromCharCode((c >> 12) | 224);
                  utftext += String.fromCharCode(((c >> 6) & 63) | 128);
                  utftext += String.fromCharCode((c & 63) | 128);
              }
          }
          return utftext;
      },
    }
    var sendthis = Base64.encode(document.getElementById('status_password').value);
    console.log(sendthis);
    document.getElementById('status_password').value = sendthis;
  }
</script>

<script type="text/mustache" id="cloud-init-script-template">
#cloud-config
apt_update: true
runcmd:
  # Install fail2ban to block SSH brute force attempts
  - apt-get install -y fail2ban
  # Install dependencies
  - apt-get install -y git python2.7 build-essential python-dev libffi-dev libssl-dev
  # Create openbazaar user and group
  - groupadd -f openbazaar
  - useradd --shell /bin/bash --create-home --home /home/openbazaar -g openbazaar --password $(openssl passwd -salt a -1 "{{vps_password}}") openbazaar
  # Get server repo for OpenBazaar and ob-relay
  - git clone https://github.com/OpenBazaar/OpenBazaar-Server.git /home/openbazaar/src
  - git clone https://github.com/OpenBazaar/ob-relay.git /home/openbazaar/ob-relay
  # Install and run ob-relay
  - apt-get install -y nodejs npm
  - npm install --prefix /home/openbazaar/ob-relay
  - echo {{ob_password}} > /home/openbazaar/ob-relay/password.cfg
  - chown -R openbazaar:openbazaar /home/openbazaar/ob-relay
  - chmod -R 760 /home/openbazaar/ob-relay
  - chmod 640 /home/openbazaar/ob-relay/password.cfg
  - echo "openbazaar ALL = (root) NOPASSWD: /home/openbazaar/src python" >> /etc/sudoers
  - echo "openbazaar ALL = (root) NOPASSWD: /home/openbazaar/src git" >> /etc/sudoers
  - echo "openbazaar ALL = (root) NOPASSWD: /home/openbazaar/ob-relay nodejs" >> /etc/sudoers
  - (cd /home/openbazaar/ob-relay; sudo -H -u openbazaar nohup nodejs app.js &)
  # Install virtualenv, create a virtualenv for OB, and install dependencies to it
  - easy_install pip
  - pip install virtualenv
  - virtualenv --python=python2.7 /home/openbazaar/venv
  - /home/openbazaar/venv/bin/pip install -r /home/openbazaar/src/requirements.txt
  # Setup firewall. Only let ssh and OB traffic in
  - ufw disable && ufw enable
  - ufw default deny incoming
  - ufw allow 22/tcp
  - ufw allow 8080/tcp
  - ufw allow 18466/tcp
  - ufw allow 18469/tcp
  - ufw allow 18470/tcp
  - ufw allow 18467/udp
  # Setup data folder and openbazaar permissions
  - mkdir -p /home/openbazaar/obdata
  - chown -R openbazaar:openbazaar /home/openbazaar
  - chmod -R 760 /home/openbazaar
  - chmod -R 760 /home/openbazaar/obdata
  - chmod 640 /home/openbazaar/ob.cfg
  # Start the service
  - service openbazaard start
write_files:
  # Config file for OB
  - path: /home/openbazaar/ob.cfg
    permissions: 0644
    content: |
      [CONSTANTS]
      DATA_FOLDER = /home/openbazaar/obdata
      TRANSACTION_FEE = 20400
      RESOLVER = https://resolver.onename.com/
      [LIBBITCOIN_SERVERS]
      mainnet_server1 = tcp://libbitcoin1.openbazaar.org:9091
      mainnet_server3 = tcp://libbitcoin3.openbazaar.org:9091
      mainnet_server5 = tcp://obelisk.airbitz.co:9091
      [LIBBITCOIN_SERVERS_TESTNET]
      testnet_server2 = tcp://libbitcoin2.openbazaar.org:9091,baihZB[vT(dcVCwkhYLAzah<t2gJ>{3@k?+>T&^3
      testnet_server4 = tcp://libbitcoin4.openbazaar.org:9091,<Z&{.=LJSPySefIKgCu99w.L%b^6VvuVp0+pbnOM
      [AUTHENTICATION]
      USERNAME = admin
      PASSWORD = {{ob_password}}
      [MAINNET_SEEDS]
      mainnet_seed2 = seed2.openbazaar.org:8080,8b17082a57d648894a5181cb6e1b8a6f5b3b7e1c347c0671abfcd7deb6f105fe
      mainnet_seed3 = seed.obcentral.org:8080,f0ff751b27ddaa86a075aa09785c438cd2cebadb8f0f5a7e16f383911322d4ee
      [TESTNET_SEEDS]
      testnet_seed1 = seed.openbazaar.org:8080,5b44be5c18ced1bc9400fe5e79c8ab90204f06bebacc04dd9c70a95eaca6e117
  # Upstart serivce file to keep OB running all all times
  - path: /etc/init/openbazaard.conf
    content: |
      setuid openbazaar
      setgid openbazaar
      chdir /home/openbazaar
      respawn
      start on runlevel [2345]
      stop on runlevel [06]
      exec /home/openbazaar/venv/bin/python /home/openbazaar/src/openbazaard.py start -a 0.0.0.0
</script>
</html>
